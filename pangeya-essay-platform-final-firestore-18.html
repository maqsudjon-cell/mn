<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pangeya Essay Platform ‚Äì New Year Edition</title>
  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">

  <!--
    This file is based on the original Pangeya Essay Platform hosted on GitHub pages.
    The markup, styling and scripts have been preserved so the core functionality
    (writing, saving, editing and printing essays; teacher mode; theme switching)
    continue to work. This edition preserves the Neon, Light and Dark themes
    from the original. A New Year mode can also be toggled on/off. When active
    it adds 3D decorations (stocking by the name field, tree/gift/Santa icons
    on the buttons and essay cards) and a gentle snowfall effect near the top
    of the page. A small fixed button in the bottom‚Äëright corner allows users
    to enable or disable the New Year mode without interfering with normal
    operation or teacher features.
  -->
  <style>
    :root {
      /* base colours and sizing inherited from the original site */
      --bg-gradient: radial-gradient(circle at top left, #3b0764, #1e1b4b 40%, #020617 80%);
      --card-bg: rgba(15, 23, 42, 0.92);
      --accent: #a855f7;
      --accent2: #ec4899;
      --accent3: #22c55e;
      --text-main: #e5e7eb;
      --text-muted: #9ca3af;
      --border-soft: rgba(148, 163, 184, 0.3);
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      min-height: 100vh;
      font-family: "Poppins", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: var(--bg-gradient);
      color: var(--text-main);
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }
    /* Light and dark themes mirror the original implementation */
    .light-theme {
      --bg-gradient: linear-gradient(135deg, #e0e7ff, #f5f3ff);
      --card-bg: #ffffff;
      --text-main: #111827;
      --text-muted: #6b7280;
      --border-soft: rgba(148, 163, 184, 0.5);
    }
    .dark-theme {
      --bg-gradient: radial-gradient(circle at top, #020617, #020617 40%, #000000 100%);
      --card-bg: #020617;
      --text-main: #e5e7eb;
      --text-muted: #9ca3af;
    }

    /*
      Pangeya theme ‚Äì a rich green palette reminiscent of deep forests.  This
      theme affects not only the page background but also button gradients
      and accent colours.  All variables defined here are used in the
      component-specific overrides further below.
    */
    .pangeya-theme {
      --bg-gradient: linear-gradient(135deg, #191414, #1db954);
      --card-bg: rgba(25, 20, 20, 0.92);
      --text-main: #f1f1f1;
      --text-muted: #b3b3b3;
      --border-soft: rgba(255, 255, 255, 0.25);
      --accent: #1db954;
      --accent2: #1ed760;
      --accent3: #1db954;
    }
    /* Glass theme ‚Äì inspired by iOS 17/18 style glass surfaces.
       It uses translucent backgrounds and applies a backdrop blur on the
       container to give the impression of frosted glass. */
    .glass-theme {
      --bg-gradient: linear-gradient(135deg, rgba(255,255,255,0.35), rgba(230,230,230,0.2));
      --card-bg: rgba(255, 255, 255, 0.2);
      --text-main: #0f172a;
      --text-muted: #334155;
      --border-soft: rgba(15, 23, 42, 0.25);
    }
    .glass-theme .inner {
      backdrop-filter: blur(16px);
    }
    /* Container styling preserved from original */
    .container {
      width: 100%;
      max-width: 900px;
      background: linear-gradient(145deg, rgba(88, 28, 135, 0.9), rgba(30, 64, 175, 0.9));
      padding: 2px;
      border-radius: 26px;
      box-shadow: 0 20px 45px rgba(0, 0, 0, 0.55);
    }
    .inner {
      background: var(--card-bg);
      border-radius: 24px;
      padding: 20px 20px 18px;
    }
    @media (min-width: 768px) {
      .inner { padding: 24px 26px 22px; }
    }
    h1 {
      font-size: 22px;
      font-weight: 600;
      text-align: center;
      margin-bottom: 10px;
    }
    .subtitle {
      text-align: center;
      font-size: 12px;
      color: var(--text-muted);
      margin-bottom: 14px;
    }
    .theme-switcher {
      display: flex;
      gap: 10px;
      margin-bottom: 16px;
    }
    .theme-btn {
      flex: 1;
      padding: 8px 10px;
      border-radius: 999px;
      border: none;
      cursor: pointer;
      background: rgba(15, 23, 42, 0.9);
      color: #e5e7eb;
      font-size: 13px;
      font-weight: 500;
      transition: all .18s ease;
    }
    .theme-btn.active {
      background: linear-gradient(135deg, #a855f7, #ec4899);
      color: white;
      transform: translateY(-1px);
      box-shadow: 0 6px 20px rgba(168, 85, 247, 0.4);
    }
    label {
      display: block;
      font-size: 13px;
      margin-bottom: 4px;
      margin-top: 6px;
    }
    /* Input and textarea styling retained from original */
    input[type="text"], textarea {
      width: 100%;
      border-radius: 14px;
      border: 1px solid var(--border-soft);
      background: rgba(15, 23, 42, 0.9);
      color: var(--text-main);
      padding: 10px 12px;
      font-size: 14px;
      outline: none;
      transition: border .15s ease, box-shadow .15s ease, background .15s ease;
    }
    textarea {
      min-height: 130px;
      resize: vertical;
    }

    /* Make the vocabulary definition box smaller.  Users often paste multiple
       vocab items into this box, so it should not take up as much vertical
       space as the essay textarea.  The global textarea rule above sets a
       fairly tall minimum height (130px).  We override it for the vocabulary
       definition input so that it appears as a compact field, while still
       allowing users to type or paste multiple lines if needed. */
    #definition {
      min-height: 80px;
    }
    input[type="text"]:focus, textarea:focus {
      border-color: #818cf8;
      box-shadow: 0 0 0 1px rgba(129, 140, 248, 0.7);
      background: rgba(15, 23, 42, 1);
    }
    .btn {
      width: 100%;
      border: none;
      border-radius: 999px;
      padding: 11px 14px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      margin-top: 10px;
      transition: transform .1s ease, box-shadow .1s ease, opacity .15s ease;
      color: white;
      position: relative; /* to anchor stickers */
      overflow: hidden;
    }
    .btn-primary {
      background: linear-gradient(135deg, #a855f7, #ec4899);
      box-shadow: 0 10px 25px rgba(236, 72, 153, 0.4);
    }
    .btn-secondary {
      background: linear-gradient(135deg, #38bdf8, #6366f1);
      box-shadow: 0 8px 20px rgba(56, 189, 248, 0.35);
    }
    .btn-teacher {
      background: linear-gradient(135deg, #22c55e, #16a34a);
      box-shadow: 0 8px 20px rgba(34, 197, 94, 0.35);
    }
    .btn:hover { transform: translateY(-1px); }
    .btn:active { transform: translateY(0); box-shadow: none; }

    /* Search controls for essay list ‚Äì provides a small name search and an AI
       button.  These controls appear next to the All Essays heading. */
    .essay-search-controls {
      display: flex;
      gap: 6px;
      align-items: center;
      margin-bottom: 6px;
      justify-content: flex-end;
    }
    .essay-search-controls input {
      flex: 1;
      padding: 4px 8px;
      border-radius: 8px;
      border: 1px solid var(--border-soft);
      background: var(--card-bg);
      color: var(--text-main);
      font-size: 12px;
    }
    .essay-search-controls input::placeholder {
      color: var(--text-muted);
      font-style: italic;
    }
    .essay-search-controls button {
      padding: 5px 10px;
      border-radius: 999px;
      border: none;
      cursor: pointer;
      font-size: 11px;
      font-weight: 500;
      color: #ffffff;
      background: linear-gradient(135deg, var(--accent), var(--accent2));
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
      transition: transform .1s ease;
    }
    .essay-search-controls button:hover { transform: translateY(-1px); }
    .essay-search-controls button:active { transform: translateY(0); }

    /* Vocabulary layout styles.  These classes format the vocabulary list
       and search controls so that the vocabulary section resembles a
       dictionary with two columns: one for the word and one for its
       definition.  Search input and buttons mirror the style of the essay
       search controls. */
    .vocab-list {
      margin-top: 6px;
      max-height: 380px;
      overflow-y: auto;
      padding-right: 2px;
    }
    .vocab-item {
      display: flex;
      align-items: flex-start;
      gap: 12px;
      background: var(--card-bg);
      border: 1px solid var(--border-soft);
      border-radius: 14px;
      padding: 8px 12px;
      margin-bottom: 6px;
      font-size: 13px;
    }
    .vocab-word {
      flex: 0 0 30%;
      font-weight: 600;
      word-break: break-word;
      margin-right: 8px;
    }
    .vocab-definition {
      flex: 1;
      color: var(--text-main);
      word-break: break-word;
    }

    /* Small delete button for each vocabulary item.  The button appears at the end
       of each vocab row and allows users to remove an entry from the database.
       It is styled similarly to other chips on the site but sized more compactly. */
    .vocab-delete-btn {
      margin-left: auto;
      padding: 2px 6px;
      font-size: 11px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      color: #ffffff;
      background: #ef4444; /* red colour for delete */
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
      transition: transform 0.1s ease;
    }
    .vocab-delete-btn:hover { transform: translateY(-1px); }
    .vocab-delete-btn:active { transform: translateY(0); }

    /* Adapt delete button colour for the Pangeya theme so it remains visible
       against dark backgrounds. */
    .pangeya-theme .vocab-delete-btn {
      background: #e84a5f;
    }
    .vocab-search-controls {
      display: flex;
      gap: 6px;
      align-items: center;
      margin-bottom: 8px;
    }
    .vocab-search-controls input {
      flex: 1;
      padding: 4px 8px;
      border-radius: 8px;
      border: 1px solid var(--border-soft);
      background: var(--card-bg);
      color: var(--text-main);
      font-size: 12px;
    }
    .vocab-search-controls input::placeholder {
      color: var(--text-muted);
      font-style: italic;
    }
    .vocab-search-controls button {
      padding: 5px 10px;
      border-radius: 999px;
      border: none;
      cursor: pointer;
      font-size: 11px;
      font-weight: 500;
      color: #ffffff;
      background: linear-gradient(135deg, var(--accent), var(--accent2));
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
      transition: transform .1s ease;
    }
    .vocab-search-controls button:hover { transform: translateY(-1px); }
    .vocab-search-controls button:active { transform: translateY(0); }

    /* Vocabulary page navigation button fixed to the top‚Äëright corner. */
    .vocab-page-btn {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 7px 12px;
      border-radius: 999px;
      background: linear-gradient(135deg, var(--accent), var(--accent2));
      color: #ffffff;
      font-size: 12px;
      font-weight: 500;
      text-decoration: none;
      z-index: 1000;
      transition: transform .1s ease, box-shadow .1s ease;
    }
    .vocab-page-btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 6px 16px rgba(0, 0, 0, 0.25);
    }

    /* Pangeya theme overrides for buttons, chips and active theme indicator.  These
       ensure that when the Pangeya theme is selected, all interactive
       elements reflect the green palette. */
    .pangeya-theme .btn-primary {
      background: linear-gradient(135deg, #1db954, #1ed760);
      box-shadow: 0 10px 25px rgba(29, 185, 84, 0.45);
    }
    .pangeya-theme .btn-secondary {
      background: linear-gradient(135deg, #159b5b, #3bbf78);
      box-shadow: 0 8px 20px rgba(29, 185, 84, 0.35);
    }
    .pangeya-theme .btn-teacher {
      background: linear-gradient(135deg, #158443, #0e5a2f);
      box-shadow: 0 8px 20px rgba(21, 134, 67, 0.35);
    }
    .pangeya-theme .chip-edit { background: #1db954; }
    .pangeya-theme .chip-delete { background: #e84a5f; }
    .pangeya-theme .chip-feedback { background: #6ad1e3; }
    .pangeya-theme .theme-btn.active {
      background: linear-gradient(135deg, #1db954, #1ed760);
      color: #ffffff;
      box-shadow: 0 6px 20px rgba(29, 185, 84, 0.4);
    }
    .teacher-panel {
      display: none;
      margin-top: 8px;
    }
    .teacher-panel input { margin-top: 6px; }
    .teacher-panel .btn-enter { margin-top: 8px; }
    .section-title {
      margin-top: 18px;
      margin-bottom: 8px;
      font-size: 15px;
      font-weight: 500;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    .section-title span.icon { font-size: 17px; }
    .essays-list {
      margin-top: 4px;
      max-height: 380px;
      overflow-y: auto;
      padding-right: 2px;
    }
    .essay-card {
      background: rgba(15, 23, 42, 0.9);
      border-radius: 18px;
      padding: 10px 12px;
      border: 1px solid rgba(148, 163, 184, 0.35);
      margin-bottom: 8px;
      font-size: 13px;
      position: relative; /* for sticker positioning */
    }
    .essay-header {
      display: flex;
      justify-content: space-between;
      gap: 10px;
      margin-bottom: 4px;
      font-size: 12px;
      color: var(--text-muted);
    }
    .essay-name { font-weight: 500; }
    .essay-text {
      white-space: pre-wrap;
      word-wrap: break-word;
      overflow-wrap: anywhere;
      margin-bottom: 6px;
      margin-top: 2px;
      color: var(--text-main);
    }
    .word-count { /* inserted from script */ }
    .feedback {
      margin-top: 4px;
      padding: 7px 8px;
      background: rgba(22, 163, 74, 0.16);
      border-left: 3px solid #22c55e;
      border-radius: 10px;
      font-size: 13px;
      white-space: pre-wrap;
      word-wrap: break-word;
    }
    .feedback .fb-check, .feedback .fb-cross {
      display: block;
      padding-left: 22px;
      position: relative;
      margin: 4px 0;
    }
    .feedback .fb-check::before {
      content: '‚úî';
      position: absolute;
      left: 0;
      color: #22c55e;
    }
    .feedback .fb-cross::before {
      content: '‚úò';
      position: absolute;
      left: 0;
      color: #ef4444;
    }
    .essay-actions {
      margin-top: 6px;
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }
    .chip-btn {
      border: none;
      border-radius: 999px;
      padding: 5px 11px;
      font-size: 11px;
      cursor: pointer;
      color: white;
    }
    .chip-edit { background: #22c55e; }
    .chip-delete { background: #ef4444; }
    .chip-feedback { background: #0ea5e9; }
    .chip-btn:active { transform: translateY(1px); }
    /* Toolbar styling for rich text editing */
    .toolbar {
      display: flex;
      gap: 8px;
      margin-bottom: 6px;
    }
    .icon-btn {
      background: transparent;
      border: 1px solid var(--border-soft);
      border-radius: 4px;
      padding: 4px 6px;
      font-size: 13px;
      color: var(--text-main);
      cursor: pointer;
    }
    .icon-btn:hover {
      background: var(--accent);
      color: #fff;
    }
    .edit-area {
      min-height: 120px;
      max-height: 300px;
      overflow-y: auto;
      padding: 8px;
      border: 1px solid var(--border-soft);
      border-radius: 6px;
      font-size: 13px;
      background: var(--card-bg);
      color: var(--text-main);
      white-space: pre-wrap;
      word-wrap: break-word;
      outline: none;
    }
    .feedback-essay {
      max-height: 200px;
      overflow-y: auto;
      margin-bottom: 8px;
      padding: 8px;
      border: 1px solid var(--border-soft);
      border-radius: 6px;
      font-size: 12px;
      background: var(--card-bg);
      color: var(--text-main);
      white-space: pre-wrap;
      word-wrap: break-word;
    }
    /* Light theme adjustments for cards and feedback */
    .light-theme .essay-card {
      background: rgba(255, 255, 255, 0.95);
      border: 1px solid rgba(0, 0, 0, 0.12);
    }
    .light-theme .essay-card .essay-text,
    .light-theme .essay-card .feedback {
      color: #111827;
    }
    .light-theme .feedback {
      background: rgba(34, 197, 94, 0.16);
      border-left: 3px solid #16a34a;
    }
    .light-theme .edit-area,
    .light-theme .feedback-essay {
      background: #f9fafb;
      color: #111827;
      border: 1px solid rgba(0, 0, 0, 0.12);
    }
    .light-theme .icon-btn {
      border: 1px solid rgba(0, 0, 0, 0.12);
      color: #111827;
    }
    .light-theme input[type="text"],
    .light-theme textarea {
      background: #f9fafb;
      color: #111827;
      border: 1px solid rgba(0, 0, 0, 0.15);
    }
    .light-theme input[type="text"]::placeholder,
    .light-theme textarea::placeholder {
      color: #6b7280;
    }
    .light-theme input[type="text"]:focus,
    .light-theme textarea:focus {
      background: #ffffff;
      border-color: #818cf8;
      box-shadow: 0 0 0 1px rgba(129, 140, 248, 0.7);
    }
    .light-theme .modal-content {
      background: #ffffff;
      color: #111827;
    }
    .light-theme #editArea,
    .light-theme #feedbackArea {
      background: #f9fafb;
      color: #111827;
      border: 1px solid rgba(0, 0, 0, 0.15);
    }
    .light-theme #editArea:focus,
    .light-theme #feedbackArea:focus {
      background: #ffffff;
      border-color: #818cf8;
    }
    /* Highlight, underline and strike styling */
    mark, .user-highlight { background-color: #fef08a; color: #111827; }
    u, .underline-text { text-decoration: underline; }
    s, .strike-text { text-decoration: line-through; }
    /* Modal styling retained */
    .modal {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.7);
      display: none;
      justify-content: center;
      align-items: center;
      padding: 16px;
      z-index: 999;
    }
    .modal-content {
      width: 100%;
      max-width: 720px;
      background: #020617;
      color: #e5e7eb;
      border-radius: 18px;
      padding: 16px 16px 14px;
      box-shadow: 0 24px 60px rgba(0, 0, 0, 0.8);
    }
    .modal-content h3 {
      margin-bottom: 8px;
      font-size: 16px;
      font-weight: 500;
    }
    #editArea, #feedbackArea {
      width: 100%;
      min-height: 200px;
      max-height: 60vh;
      padding: 10px 12px;
      border-radius: 12px;
      border: 1px solid rgba(148, 163, 184, 0.6);
      background: #020617;
      color: #e5e7eb;
      font-size: 14px;
      resize: vertical;
      outline: none;
    }
    #editArea:focus, #feedbackArea:focus {
      border-color: #818cf8;
      box-shadow: 0 0 0 1px rgba(129, 140, 248, 0.7);
    }
    .modal-actions {
      margin-top: 10px;
      display: flex;
      justify-content: flex-end;
      flex-wrap: wrap;
      gap: 8px;
    }
    .small-btn {
      padding: 7px 14px;
      border-radius: 999px;
      border: none;
      font-size: 12px;
      cursor: pointer;
      color: white;
    }
    .small-save { background: #22c55e; }
    .small-cancel { background: #ef4444; }
    @media (max-width: 480px) {
      h1 { font-size: 18px; }
      .subtitle { font-size: 11px; }
      .essay-card { font-size: 12px; }
      .modal-content { padding: 14px; }
      #editArea, #feedbackArea { min-height: 170px; }
    }
    /* ================== New Year decorations ================== */
    /* Wrapper around the name input so the stocking can be positioned nicely */
    .name-wrapper { position: relative; }
    .ny-icon {
      position: absolute;
      top: 50%;
      right: 10px;
      transform: translateY(-50%);
      font-size: 22px;
      line-height: 1;
      display: none;
      pointer-events: none;
    }
    /* Show icons when New Year mode is on */
    body.newyear-mode .ny-icon { display: block; }
    /* Add extra padding to the input when the icon is visible */
    body.newyear-mode .name-wrapper input[type="text"] { padding-right: 45px; }
    /* Hide legacy image stickers */
    .btn .btn-sticker,
    body.newyear-mode .btn .btn-sticker,
    .essay-card .card-sticker,
    body.newyear-mode .essay-card .card-sticker {
      display: none !important;
    }

    /* Additional rule to hide any image inside buttons and essay cards (fallback for stubborn base64 icons) */
    .btn img {
      display: none !important;
    }
    .essay-card .card-sticker {
      display: none !important;
    }
    /* Emoji stickers for buttons */
    .btn .emoji-sticker {
      position: absolute;
      /* Position the emoji inside the button to be fully visible */
      top: 50%;
      right: 12px;
      transform: translateY(-50%);
      font-size: 24px;
      line-height: 1;
      pointer-events: none;
    }
    /* Emoji sticker for essay cards */
    .essay-card .emoji-card-sticker {
      position: absolute;
      /* Position near bottom-right corner but fully inside the card */
      bottom: 8px;
      right: 8px;
      font-size: 22px;
      line-height: 1;
      pointer-events: none;
    }
    /* Snow container spans only the header region; pointer‚Äëevents none ensures typing is unaffected */
    .snow-container {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 160px;
      overflow: hidden;
      pointer-events: none;
      display: none;
      z-index: 1;
    }
    body.newyear-mode .snow-container { display: block; }
    .snowflake {
      position: absolute;
      top: -10px;
      color: #ffffff;
      opacity: 0.9;
      user-select: none;
      will-change: transform;
    }
    /* Define individual flakes with varying animation durations, delays and sizes */
    @keyframes fall {
      0% { transform: translateY(0) rotate(0deg); }
      100% { transform: translateY(180px) rotate(360deg); }
    }
    .snowflake:nth-child(1) { left: 5%; font-size: 12px; animation: fall 7s linear infinite; animation-delay: 0s; }
    .snowflake:nth-child(2) { left: 15%; font-size: 16px; animation: fall 10s linear infinite; animation-delay: 2s; }
    .snowflake:nth-child(3) { left: 25%; font-size: 10px; animation: fall 8s linear infinite; animation-delay: 4s; }
    .snowflake:nth-child(4) { left: 35%; font-size: 14px; animation: fall 9s linear infinite; animation-delay: 1s; }
    .snowflake:nth-child(5) { left: 45%; font-size: 13px; animation: fall 6s linear infinite; animation-delay: 3s; }
    .snowflake:nth-child(6) { left: 55%; font-size: 11px; animation: fall 8s linear infinite; animation-delay: 5s; }
    .snowflake:nth-child(7) { left: 65%; font-size: 15px; animation: fall 10s linear infinite; animation-delay: 0.5s; }
    .snowflake:nth-child(8) { left: 75%; font-size: 12px; animation: fall 7s linear infinite; animation-delay: 2.5s; }
    .snowflake:nth-child(9) { left: 85%; font-size: 14px; animation: fall 9s linear infinite; animation-delay: 1.5s; }
    .snowflake:nth-child(10) { left: 95%; font-size: 11px; animation: fall 8s linear infinite; animation-delay: 3.5s; }
    /* Removed the New Year toggle styles; snow is always on */
  </style>
</head>
<body class="neon-theme newyear-mode">
  <!-- Fixed button linking to the vocabulary page -->
  <!-- Button to switch to the vocabulary section within the same page -->
  <a href="#" class="vocab-page-btn" onclick="switchToVocab(); return false;">Vocabulary üìñ</a>
  <div class="container">
    <div id="essaySection" class="inner">
      <h1>‚ú® Pangeya Essay Platform</h1>
      <div class="subtitle">Write, save and print essays. Teachers can leave feedback with a secret key.</div>
      <!-- Snow effect overlay (falls within header area) -->
      <div class="snow-container" aria-hidden="true">
        <div class="snowflake">‚ùÜ</div>
        <div class="snowflake">‚ùÖ</div>
        <div class="snowflake">‚ùÜ</div>
        <div class="snowflake">‚ùÑ</div>
        <div class="snowflake">‚ùÖ</div>
        <div class="snowflake">‚ùÜ</div>
        <div class="snowflake">‚ùÖ</div>
        <div class="snowflake">‚ùÑ</div>
        <div class="snowflake">‚ùÜ</div>
        <div class="snowflake">‚ùÖ</div>
      </div>
      <!-- Theme switcher: Neon, Light, Dark and the new Glass -->
      <div class="theme-switcher">
        <button class="theme-btn active" id="neonTheme">Neon</button>
        <button class="theme-btn" id="lightTheme">Light</button>
        <button class="theme-btn" id="darkTheme">Dark</button>
        <button class="theme-btn" id="pangeyaTheme">Pangeya</button>
        <!-- Removed the unused Glass mode button -->
      </div>
      <!-- Name input wrapped so the tree emoji can sit inside -->
      <label for="name">Your name</label>
      <div class="name-wrapper">
        <input id="name" type="text" placeholder="Enter your name" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">
        <!-- Use an emoji for the name icon instead of an image -->
        <span class="ny-icon">üéÑ</span>
      </div>
      <!-- Essay textarea -->
      <label for="essay">Write your essay</label>
      <textarea id="essay" placeholder="Write your essay..." autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"></textarea>
      <!-- Primary actions with New Year stickers (tree, gift, Santa) -->
      <button class="btn btn-primary" id="submitBtn">Submit
        <span class="emoji-sticker">üéâ</span>
        <img src="data:image/png;base64,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" alt="Christmas tree" class="btn-sticker">
      </button>
      <button class="btn btn-secondary" id="pdfBtn">Download PDF
        <span class="emoji-sticker">üéÅ</span>
        <img src="data:image/png;base64,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" alt="Gift" class="btn-sticker">
      </button>
      <button class="btn btn-teacher" id="teacherToggle">Teacher Login
        <span class="emoji-sticker">üéÖ</span>
        <img src="data:image/png;base64,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" alt="Santa" class="btn-sticker">
      </button>
      <!-- Hidden teacher panel revealed when logging in -->
      <div class="teacher-panel" id="teacherPanel">
        <input id="teacherKey" type="text" placeholder="Enter teacher key" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">
        <button class="btn btn-teacher btn-enter" id="teacherEnter">Enter</button>
      </div>
      <!-- Essays list heading -->
      <div class="section-title">
        <span class="icon">üéÑ</span>
        <span>All Essays</span>
      </div>
    <!-- Search bar and AI button for finding essays by author name -->
    <div class="essay-search-controls">
      <input id="essaySearch" type="text" placeholder="Search by name">
      <button id="essaySearchBtn">Find essay with AI</button>
    </div>
      <div class="essays-list" id="essaysList"></div>
    </div> <!-- end of essaySection -->

    <!-- Vocabulary section: initially hidden; becomes visible when the user clicks the Vocabulary button.
         This section allows users to add new words and definitions, search existing vocabulary by word,
         and displays entries in a two-column dictionary style. -->
    <div id="vocabSection" class="inner" style="display:none;">
      <h1>üìö Pangeya Vocabulary</h1>
      <div class="subtitle">Learn new words and add your own definitions</div>
      <!-- Optional theme switcher for the vocabulary section. Buttons call setTheme with the
           appropriate argument just like in the essay section. Unique IDs are used to avoid
           duplicate elements. -->
      <div class="theme-switcher">
        <button class="theme-btn" id="neonThemeV" onclick="setTheme('neon')">Neon</button>
        <button class="theme-btn" id="lightThemeV" onclick="setTheme('light')">Light</button>
        <button class="theme-btn" id="darkThemeV" onclick="setTheme('dark')">Dark</button>
        <button class="theme-btn" id="pangeyaThemeV" onclick="setTheme('pangeya')">Pangeya</button>
      </div>
      <!-- Form for adding vocabulary.  Users can either enter a single word and definition
           or paste multiple numbered entries into the definition field to add many at once. -->
      <label for="word">Word</label>
      <input id="word" type="text" placeholder="Enter a new word" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">
      <label for="definition">Definition</label>
      <textarea id="definition" placeholder="Enter the definition" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"></textarea>
      <button class="btn btn-primary" id="addVocabBtn">Add Word</button>
      <!-- Vocabulary list heading and search controls -->
      <div class="section-title">
        <span class="icon">üìö</span>
        <span>Vocabulary List</span>
      </div>
      <div class="vocab-search-controls">
        <input id="vocabSearch" type="text" placeholder="Search word">
        <button id="vocabSearchBtn">Search</button>
      </div>
      <div class="vocab-list" id="vocabList"></div>
      <button class="btn btn-secondary" id="backToEssays">‚Üê Back to Essays</button>
    </div> <!-- end of vocabSection -->
  </div>
  <!-- Snow now always falls; removed toggle button -->
  <!-- Edit Essay Modal -->
  <div class="modal" id="editModal">
    <div class="modal-content">
      <h3>Edit essay</h3>
      <!-- toolbar for text formatting -->
      <div class="toolbar">
        <button class="icon-btn" title="Highlight Text" onclick="highlightSelection()">üñç</button>
        <button class="icon-btn" title="Underline Text" onclick="underlineSelection()"><u>U</u></button>
        <button class="icon-btn" title="Strikethrough Text" onclick="strikeSelection()"><s>S</s></button>
      </div>
      <div id="editArea" class="edit-area" contenteditable="true" spellcheck="false" autocorrect="off" autocapitalize="off"></div>
      <div class="modal-actions">
        <button class="small-btn small-save" onclick="saveEdit()">Save</button>
        <button class="small-btn small-cancel" onclick="closeEditModal()">Cancel</button>
      </div>
    </div>
  </div>
  <!-- Feedback Modal -->
  <div class="modal" id="feedbackModal">
    <div class="modal-content">
      <h3>Add / edit teacher feedback</h3>
      <div id="feedbackEssay" class="feedback-essay" contenteditable="true" spellcheck="false" autocorrect="off" autocapitalize="off"></div>
      <div class="toolbar">
        <button class="icon-btn" title="Highlight Text" onclick="highlightSelection()">üñç</button>
        <button class="icon-btn" title="Underline Text" onclick="underlineSelection()"><u>U</u></button>
        <button class="icon-btn" title="Strikethrough Text" onclick="strikeSelection()"><s>S</s></button>
      </div>
      <textarea id="feedbackArea" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"></textarea>
      <div class="modal-actions">
        <button class="small-btn small-save" onclick="saveFeedback()">Save</button>
        <button class="small-btn small-cancel" onclick="closeFeedbackModal()">Cancel</button>
      </div>
    </div>
  </div>
  <!-- About / Info Modal -->
  <div class="modal" id="infoModal">
    <div class="modal-content">
      <h3>Author Information</h3>
      <div style="font-size:14px; line-height:1.6; white-space:pre-wrap;">üë§ Developed by: Maqsudjon Polatov
Creator of:
‚Ä¢ Pangeya Essay Platform
‚Ä¢ Uzglidex Marketplace
‚Ä¢ 37P.AI automated tools
‚Ä¢ NubAI medical assistant
‚Ä¢ Matsumi music project

üìå Support development
If you would like to support future updates and improvements,
you can send a donation to the following card:

üí≥ 9860 6004 0548 1208

Or pay via QR:</div>
      <img src="donation_qr.png" alt="Donation QR Code" class="donation-qr" onerror="this.style.display='none'">
      <p style="font-size:13px; margin-top:12px; color:var(--text-muted);">Press <strong>Ctrl + `</strong> again to close this window.</p>
      <div class="modal-actions">
        <button class="small-btn small-cancel" onclick="toggleInfoModal()">Close</button>
      </div>
    </div>
  </div>
  <!-- User Guide Modal -->
  <div class="modal" id="guideModal">
    <div class="modal-content">
      <h3>User Guide</h3>
      <h4 style="margin-top:10px; font-size:15px;">For Students</h4>
      <p style="font-size:13px; margin-bottom:8px;">1. Enter your name in the <em>Your name</em> field.</p>
      <p style="font-size:13px; margin-bottom:8px;">2. Write your essay in the <em>Write your essay</em> box.</p>
      <p style="font-size:13px; margin-bottom:8px;">3. Click <strong>Submit</strong> to save your essay to the cloud.</p>
      <p style="font-size:13px; margin-bottom:8px;">4. You can edit your essay by clicking the <strong>Edit</strong> button next to it.</p>
      <p style="font-size:13px; margin-bottom:8px;">5. To download your essay as a PDF, click <strong>Download PDF</strong>.</p>
      <h4 style="margin-top:14px; font-size:15px;">For Teachers</h4>
      <p style="font-size:13px; margin-bottom:8px;">1. Enter the secret teacher key in the <em>Teacher Key</em> field and click <strong>Enter</strong> to access teacher mode.</p>
      <p style="font-size:13px; margin-bottom:8px;">2. Once in teacher mode, you can edit any essay, highlight important sections, underline useful phrases, or strike through errors.</p>
      <p style="font-size:13px; margin-bottom:8px;">3. You can also add or edit feedback by clicking <strong>Add/Edit Feedback</strong> next to an essay.</p>
      <p style="font-size:13px; margin-bottom:8px;">4. The teacher key is confidential. If you need the key, please contact <strong>Maqsudjon Polatov</strong> personally to request it.</p>
      <p style="font-size:13px; margin-bottom:8px;">Press <strong>Ctrl + ;</strong> again to close this window and return to the platform.</p>
      <div class="modal-actions">
        <button class="small-btn small-cancel" onclick="toggleGuideModal()">Close</button>
      </div>
    </div>
  </div>
  <!-- Include jsPDF from CDN for PDF export -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <!-- Main application script; imported modules from Firebase remain unchanged.  Additional
       functions implement the new Glass theme, New Year decorations and toggle logic. -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-analytics.js";
    import {
      getFirestore,
      collection,
      addDoc,
      getDocs,
      doc,
      updateDoc,
      deleteDoc
    } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js";

    // Constants
    const TEACHER_KEY = 'CTNLC';
    let teacherMode = false;
    let currentEditId = null;
    let currentFeedbackId = null;

    // Firebase configuration (copied from the original)
    const firebaseConfig = {
      apiKey: "AIzaSyBnmbg7CyLki-M1E4rxPevJ741yTykliDA",
      authDomain: "pangeya-essay.firebaseapp.com",
      projectId: "pangeya-essay",
      storageBucket: "pangeya-essay.appspot.com",
      messagingSenderId: "783326121302",
      appId: "1:783326121302:web:7d73c5110fb5682e5fdaf7",
      measurementId: "G-0L1X6WHT1E"
    };
    // Initialize Firebase and Firestore
    const app = initializeApp(firebaseConfig);
    getAnalytics(app);
    const db = getFirestore(app);
    const essaysRef = collection(db, "essays");
    // Reference to the vocabulary collection for storing words and definitions
    const vocabRef = collection(db, "vocab");

    /**
     * Escape HTML special characters to prevent XSS when rendering content from
     * Firestore.  Borrowed from the original site.
     */
    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    /**
     * Render essays from Firestore into the list.  This function builds each
     * essay card including word count and optional feedback.  Positioning is
     * preserved from the original; we simply assign a class and rely on CSS for
     * the New Year sticker on each card.
     */
    async function renderEssays(queryName = '') {
      const container = document.getElementById('essaysList');
      container.innerHTML = '';
      const snapshot = await getDocs(essaysRef);
      if (snapshot.empty) {
        container.innerHTML =
          '<div style="font-size:12px;color:var(--text-muted);padding:2px 2px 6px;">No essays yet. Write and submit your first essay!</div>';
        return;
      }
      let docsArray = [];
      snapshot.forEach(docSnap => {
        docsArray.push({ id: docSnap.id, data: docSnap.data() });
      });
      const parseDateString = (str) => {
        if (!str) return 0;
        const parts = str.split(',');
        const datePart = parts[0].trim();
        const timePart = parts[1] ? parts[1].trim() : '';
        let day, month, year;
        if (datePart.includes('.')) {
          [day, month, year] = datePart.split('.');
        } else if (datePart.includes('/')) {
          const dp = datePart.split('/');
          if (parseInt(dp[0], 10) > 12) {
            [day, month, year] = dp;
          } else {
            [month, day, year] = dp;
          }
        } else if (datePart.includes('-')) {
          const dp = datePart.split('-');
          if (dp[0].length === 4) {
            [year, month, day] = dp;
          } else {
            [month, day, year] = dp;
          }
        } else {
          return 0;
        }
        let hours = 0, minutes = 0, seconds = 0;
        if (timePart) {
          const tp = timePart.split(':');
          hours = parseInt(tp[0], 10) || 0;
          minutes = parseInt(tp[1], 10) || 0;
          seconds = parseInt(tp[2], 10) || 0;
        }
        const y = parseInt(year, 10);
        const m = parseInt(month, 10) - 1;
        const d = parseInt(day, 10);
        return new Date(y, m, d, hours, minutes, seconds).getTime();
      };
      // Optionally filter by author name if a search query was provided.
      const qName = (queryName || '').toString().trim().toLowerCase();
      let filteredArray = docsArray;
      if (qName) {
        filteredArray = docsArray.filter(item => {
          const nm = (item.data.name || '').toString().toLowerCase();
          return nm.includes(qName);
        });
      }
      filteredArray.sort((a, b) => {
        const tA = typeof a.data.timestamp === 'number' ? a.data.timestamp : parseDateString(a.data.date);
        const tB = typeof b.data.timestamp === 'number' ? b.data.timestamp : parseDateString(b.data.date);
        return tB - tA;
      });
      filteredArray.forEach(item => {
        const data = item.data;
        const docId = item.id;
        const card = document.createElement('div');
        card.className = 'essay-card';
        // Header with name and date
        const header = document.createElement('div');
        header.className = 'essay-header';
        const nameSpan = document.createElement('span');
        nameSpan.className = 'essay-name';
        // Prefix the author's name with a tree emoji so that a üéÑ appears before every name
        nameSpan.textContent = (data.name ? `üéÑ ${data.name}` : 'üéÑ Unknown');
        const dateSpan = document.createElement('span');
        dateSpan.textContent = data.date || '';
        header.appendChild(nameSpan);
        header.appendChild(dateSpan);
        // Essay text
        const textDiv = document.createElement('div');
        textDiv.className = 'essay-text';
        textDiv.innerHTML = data.essay || '';
        card.appendChild(header);
        card.appendChild(textDiv);
        // Word count
        const rawText = textDiv.textContent || '';
        const wordsArray = rawText.trim().split(/\s+/).filter(word => word.length > 0);
        const wordCount = wordsArray.length;
        const wordCountDiv = document.createElement('div');
        wordCountDiv.className = 'word-count';
        wordCountDiv.style.fontSize = '12px';
        wordCountDiv.style.color = 'var(--text-muted)';
        wordCountDiv.style.marginBottom = '4px';
        wordCountDiv.textContent = `Word count: ${wordCount}`;
        card.appendChild(wordCountDiv);
        // Feedback block
        if (data.feedback) {
          const fb = document.createElement('div');
          fb.className = 'feedback';
          const lines = data.feedback.split('\n');
          const formattedLines = lines.map(line => {
            const trimmed = line.trim();
            if (trimmed.startsWith('‚úî')) {
              const content = trimmed.substring(1).trim();
              return '<span class="fb-check">' + escapeHtml(content) + '</span>';
            } else if (trimmed.startsWith('‚úò')) {
              const content = trimmed.substring(1).trim();
              return '<span class="fb-cross">' + escapeHtml(content) + '</span>';
            }
            return escapeHtml(line);
          });
          fb.innerHTML = '<strong>Teacher Feedback:</strong><br>' + formattedLines.join('<br>');
          card.appendChild(fb);
        }
        // Action buttons
        const actions = document.createElement('div');
        actions.className = 'essay-actions';
        const editBtn = document.createElement('button');
        editBtn.className = 'chip-btn chip-edit';
        editBtn.textContent = 'Edit';
        editBtn.onclick = () => openEditModal(docId, data);
        const delBtn = document.createElement('button');
        delBtn.className = 'chip-btn chip-delete';
        delBtn.textContent = 'Delete';
        delBtn.onclick = () => deleteEssay(docId);
        delBtn.style.display = teacherMode ? 'inline-block' : 'none';
        const fbBtn = document.createElement('button');
        fbBtn.className = 'chip-btn chip-feedback';
        fbBtn.textContent = 'Add/Edit Feedback';
        fbBtn.style.display = teacherMode ? 'inline-block' : 'none';
        fbBtn.onclick = () => openFeedbackModal(docId, data);
        actions.appendChild(editBtn);
        actions.appendChild(delBtn);
        actions.appendChild(fbBtn);
        card.appendChild(actions);
        // Card sticker element for New Year mode
        const cardSticker = document.createElement('img');
        // Use embedded gift icon for the essay card sticker
        cardSticker.src = 'data:image/png;base64,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';
        cardSticker.alt = 'Gift sticker';
        cardSticker.className = 'card-sticker';
        card.appendChild(cardSticker);

        // Add our own emoji sticker to the card in the bottom right corner
        const cardEmoji = document.createElement('span');
        cardEmoji.className = 'emoji-card-sticker';
        cardEmoji.textContent = 'üéÅ';
        card.appendChild(cardEmoji);

        container.appendChild(card);
      });
    }

    /**
     * Handle essay search initiated by the user.  This helper reads the
     * contents of the search input and calls renderEssays with the
     * provided query.  If the input is empty, all essays are shown.
     */
    function searchEssays() {
      const input = document.getElementById('essaySearch');
      const query = input ? input.value.trim() : '';
      renderEssays(query);
    }

    /** Submit a new essay to Firestore */
    async function submitEssay() {
      const nameInput = document.getElementById('name');
      const essayInput = document.getElementById('essay');
      const name = nameInput.value.trim();
      const essay = essayInput.value.trim();
      if (!essay) {
        alert('Please write an essay before submitting.');
        return;
      }
      await addDoc(essaysRef, {
        name: name || 'Unknown',
        essay: essay,
        date: new Date().toLocaleString(),
        timestamp: Date.now(),
        feedback: ''
      });
      renderEssays();
      essayInput.value = '';
      nameInput.value = '';
      alert('Essay saved to the cloud.');
    }

    // Edit modal handlers
    function openEditModal(docId, data) {
      currentEditId = docId;
      const editArea = document.getElementById('editArea');
      editArea.innerHTML = data.essay || '';
      document.getElementById('editModal').style.display = 'flex';
    }
    function closeEditModal() {
      document.getElementById('editModal').style.display = 'none';
      currentEditId = null;
    }
    async function saveEdit() {
      if (!currentEditId) return;
      const updated = document.getElementById('editArea').innerHTML;
      await updateDoc(doc(db, 'essays', currentEditId), { essay: updated });
      renderEssays();
      closeEditModal();
    }

    // Feedback modal handlers
    function openFeedbackModal(docId, data) {
      currentFeedbackId = docId;
      document.getElementById('feedbackArea').value = data.feedback || '';
      const essayDiv = document.getElementById('feedbackEssay');
      essayDiv.innerHTML = data.essay || '';
      document.getElementById('feedbackModal').style.display = 'flex';
    }
    function closeFeedbackModal() {
      document.getElementById('feedbackModal').style.display = 'none';
      currentFeedbackId = null;
    }
    async function saveFeedback() {
      if (!currentFeedbackId) return;
      const updated = document.getElementById('feedbackArea').value;
      const essayUpdated = document.getElementById('feedbackEssay').innerHTML;
      await updateDoc(doc(db, 'essays', currentFeedbackId), { feedback: updated, essay: essayUpdated });
      renderEssays();
      closeFeedbackModal();
    }

    /** Delete an essay */
    async function deleteEssay(docId) {
      if (!confirm('Delete this essay?')) return;
      await deleteDoc(doc(db, 'essays', docId));
      renderEssays();
    }

    // Rich text formatting commands for the edit and feedback modals
    function findTagParent(node, tagNames, editableParent) {
      while (node && node !== editableParent) {
        if (node.nodeType === 1) {
          const nodeName = node.nodeName.toLowerCase();
          if (tagNames.includes(nodeName)) {
            return node;
          }
          if (node.classList) {
            if (tagNames.includes('mark') && node.classList.contains('user-highlight')) return node;
            if (tagNames.includes('u') && node.classList.contains('underline-text')) return node;
            if (tagNames.includes('s') && node.classList.contains('strike-text')) return node;
          }
        }
        node = node.parentNode;
      }
      return null;
    }
    function getEditableParent(sel) {
      if (!sel.rangeCount) return null;
      const range = sel.getRangeAt(0);
      let containerNode = range.commonAncestorContainer;
      let editableParent = null;
      if (containerNode.nodeType === 1) {
        editableParent = containerNode.closest('[contenteditable="true"]');
      } else {
        editableParent = containerNode.parentElement ? containerNode.parentElement.closest('[contenteditable="true"]') : null;
      }
      if (!editableParent || (editableParent.id !== 'editArea' && editableParent.id !== 'feedbackEssay')) return null;
      return editableParent;
    }
    function highlightSelection() {
      const sel = window.getSelection();
      const editableParent = getEditableParent(sel);
      if (!editableParent) return;
      editableParent.focus();
      const selectedText = sel.toString();
      if (!selectedText) return;
      let markParent = findTagParent(sel.anchorNode, ['mark'], editableParent) || findTagParent(sel.focusNode, ['mark'], editableParent);
      if (markParent) {
        const text = markParent.textContent;
        markParent.replaceWith(document.createTextNode(text));
      } else {
        const markHtml = `<mark>${selectedText}</mark>`;
        document.execCommand('insertHTML', false, markHtml);
      }
    }
    function underlineSelection() {
      const sel = window.getSelection();
      const editableParent = getEditableParent(sel);
      if (!editableParent) return;
      editableParent.focus();
      const selectedText = sel.toString();
      if (!selectedText) return;
      let underlineParent = findTagParent(sel.anchorNode, ['u'], editableParent) || findTagParent(sel.focusNode, ['u'], editableParent);
      if (underlineParent) {
        const text = underlineParent.textContent;
        underlineParent.replaceWith(document.createTextNode(text));
      } else {
        const uHtml = `<u>${selectedText}</u>`;
        document.execCommand('insertHTML', false, uHtml);
      }
    }
    function strikeSelection() {
      const sel = window.getSelection();
      const editableParent = getEditableParent(sel);
      if (!editableParent) return;
      editableParent.focus();
      const selectedText = sel.toString();
      if (!selectedText) return;
      let strikeParent = findTagParent(sel.anchorNode, ['s'], editableParent) || findTagParent(sel.focusNode, ['s'], editableParent);
      if (strikeParent) {
        const text = strikeParent.textContent;
        strikeParent.replaceWith(document.createTextNode(text));
      } else {
        const sHtml = `<s>${selectedText}</s>`;
        document.execCommand('insertHTML', false, sHtml);
      }
    }

    // Teacher panel toggling
    function toggleTeacherPanel() {
      const panel = document.getElementById('teacherPanel');
      panel.style.display = panel.style.display === 'block' ? 'none' : 'block';
    }
    function enterTeacherMode() {
      const key = document.getElementById('teacherKey').value.trim();
      if (!key) {
        alert('Enter teacher key.');
        return;
      }
      if (key === TEACHER_KEY) {
        teacherMode = true;
        alert('Teacher mode enabled.');
        document.getElementById('teacherKey').value = '';
        document.getElementById('teacherPanel').style.display = 'none';
        renderEssays();
      } else {
        alert('Wrong key.');
      }
    }

    /**
     * Theme switching ‚Äì extended from the original to support a glass theme.  The
     * Neon theme is treated as default when none of the other themes are
     * specified.  Active button styling is updated accordingly.
     */
    function setTheme(theme) {
      const body = document.body;
      // Remove any previously applied theme classes. Glass theme is no longer supported.
      body.classList.remove('light-theme', 'dark-theme', 'pangeya-theme');
      document.getElementById('neonTheme').classList.remove('active');
      document.getElementById('lightTheme').classList.remove('active');
      document.getElementById('darkTheme').classList.remove('active');
      const pangeyaBtn = document.getElementById('pangeyaTheme');
      if (pangeyaBtn) pangeyaBtn.classList.remove('active');
      // Reset active states on duplicate theme buttons in the vocabulary section
      const neonV = document.getElementById('neonThemeV');
      const lightV = document.getElementById('lightThemeV');
      const darkV = document.getElementById('darkThemeV');
      const pangeyaV = document.getElementById('pangeyaThemeV');
      if (neonV) neonV.classList.remove('active');
      if (lightV) lightV.classList.remove('active');
      if (darkV) darkV.classList.remove('active');
      if (pangeyaV) pangeyaV.classList.remove('active');
      if (theme === 'light') {
        body.classList.add('light-theme');
        document.getElementById('lightTheme').classList.add('active');
        if (lightV) lightV.classList.add('active');
      } else if (theme === 'dark') {
        body.classList.add('dark-theme');
        document.getElementById('darkTheme').classList.add('active');
        if (darkV) darkV.classList.add('active');
      } else if (theme === 'pangeya') {
        body.classList.add('pangeya-theme');
        if (pangeyaBtn) pangeyaBtn.classList.add('active');
        if (pangeyaV) pangeyaV.classList.add('active');
      } else {
        document.getElementById('neonTheme').classList.add('active');
        if (neonV) neonV.classList.add('active');
      }
    }

    /**
     * PDF download via jsPDF.  Retains the behaviour of the original site.
     */
    async function downloadPDF() {
      const { jsPDF } = window.jspdf;
      const docPDF = new jsPDF({ unit: 'pt', format: 'a4' });
      let name = document.getElementById('name').value.trim();
      let essay = document.getElementById('essay').value.trim();
      if (!name || !essay) {
        const snapshot = await getDocs(essaysRef);
        const docsList = snapshot.docs;
        if (docsList.length) {
          const last = docsList[docsList.length - 1].data();
          if (!name) name = last.name || 'Unknown';
          if (!essay) essay = last.essay || '';
        }
      }
      if (!essay) {
        alert('There is no essay text to export.');
        return;
      }
      if (!name) name = 'Unknown';
      docPDF.setFontSize(22);
      docPDF.setTextColor(140, 0, 255);
      docPDF.text('Pangeya Essay Report', 40, 50);
      docPDF.setFontSize(12);
      docPDF.setTextColor(0, 0, 0);
      docPDF.text('Name: ' + name, 40, 90);
      docPDF.text('Date: ' + new Date().toLocaleString(), 40, 110);
      docPDF.setFontSize(14);
      docPDF.setTextColor(30, 30, 30);
      docPDF.text('Essay:', 40, 150);
      const lines = docPDF.splitTextToSize(essay, 520);
      docPDF.text(lines, 40, 180);
      docPDF.save('pangeya-essay.pdf');
    }

    // Info and guide modals toggling
    function toggleInfoModal() {
      const infoModal = document.getElementById('infoModal');
      if (!infoModal) return;
      infoModal.style.display = infoModal.style.display === 'flex' ? 'none' : 'flex';
    }
    window.toggleInfoModal = toggleInfoModal;
    function toggleGuideModal() {
      const guideModal = document.getElementById('guideModal');
      if (!guideModal) return;
      guideModal.style.display = guideModal.style.display === 'flex' ? 'none' : 'flex';
    }
    window.toggleGuideModal = toggleGuideModal;

    // Keyboard shortcuts to open modals
    document.addEventListener('keydown', (e) => {
      if ((e.ctrlKey || e.metaKey) && e.key === ';') {
        e.preventDefault();
        e.stopPropagation();
        toggleGuideModal();
        return;
      }
      if ((e.ctrlKey || e.metaKey) && e.key === '`') {
        e.preventDefault();
        e.stopPropagation();
        toggleInfoModal();
        return;
      }
    });
    // Close modals when clicking outside content
    window.addEventListener('click', (e) => {
      const editM = document.getElementById('editModal');
      const fbM = document.getElementById('feedbackModal');
      if (e.target === editM) closeEditModal();
      if (e.target === fbM) closeFeedbackModal();
      const infoM = document.getElementById('infoModal');
      const guideM = document.getElementById('guideModal');
      if (e.target === infoM) toggleInfoModal();
      if (e.target === guideM) toggleGuideModal();
    });

    // Event listeners for main controls
    document.getElementById('submitBtn').addEventListener('click', submitEssay);
    document.getElementById('pdfBtn').addEventListener('click', downloadPDF);
    document.getElementById('teacherToggle').addEventListener('click', toggleTeacherPanel);
    document.getElementById('teacherEnter').addEventListener('click', enterTeacherMode);
    document.getElementById('neonTheme').addEventListener('click', () => setTheme('neon'));
    document.getElementById('lightTheme').addEventListener('click', () => setTheme('light'));
    document.getElementById('darkTheme').addEventListener('click', () => setTheme('dark'));

    // Pangeya theme button ‚Äì apply the green palette when clicked
    const pangeyaBtn = document.getElementById('pangeyaTheme');
    if (pangeyaBtn) {
      pangeyaBtn.addEventListener('click', () => setTheme('pangeya'));
    }

    // Search button and input events
    const essaySearchBtn = document.getElementById('essaySearchBtn');
    const essaySearchInput = document.getElementById('essaySearch');
    if (essaySearchBtn) {
      essaySearchBtn.addEventListener('click', searchEssays);
    }
    if (essaySearchInput) {
      essaySearchInput.addEventListener('keydown', (e) => {
        if (e.key === 'Enter') {
          e.preventDefault();
          searchEssays();
        }
      });
    }

    // Snowfall is always enabled; removed New Year toggle logic

    // Initial render
    renderEssays();

    // Also render vocabulary list on load
    renderVocab();

    // =============================================
    // Vocabulary module
    // Functions and event bindings for the vocabulary section are defined below.

    // Show the vocabulary section and hide the essay section
    function switchToVocab() {
      const essaySection = document.getElementById('essaySection');
      const vocabSection = document.getElementById('vocabSection');
      if (essaySection && vocabSection) {
        essaySection.style.display = 'none';
        vocabSection.style.display = 'block';
      }
    }

    // Return to the essay section from the vocabulary section
    function switchToEssays() {
      const essaySection = document.getElementById('essaySection');
      const vocabSection = document.getElementById('vocabSection');
      if (essaySection && vocabSection) {
        vocabSection.style.display = 'none';
        essaySection.style.display = 'block';
      }
    }

    // Render vocabulary items into the list. Items are sorted by timestamp descending.
    async function renderVocab(query = '') {
      const container = document.getElementById('vocabList');
      if (!container) return;
      container.innerHTML = '';
      const snapshot = await getDocs(vocabRef);
      if (snapshot.empty) {
        container.innerHTML = '<div style="font-size:12px;color:var(--text-muted);padding:2px 2px 6px;">No vocabulary items yet. Add your first word!</div>';
        return;
      }
      const items = [];
      snapshot.forEach(docSnap => {
        items.push({ id: docSnap.id, data: docSnap.data() });
      });
      items.sort((a, b) => {
        const tA = typeof a.data.timestamp === 'number' ? a.data.timestamp : 0;
        const tB = typeof b.data.timestamp === 'number' ? b.data.timestamp : 0;
        return tB - tA;
      });
      const q = query.trim().toLowerCase();
      const filtered = q ? items.filter(item => ((item.data.word || '').toLowerCase().includes(q))) : items;
      if (!filtered.length) {
        const message = 'No results for "' + q + '".';
        container.innerHTML = '<div style="font-size:12px;color:var(--text-muted);padding:2px 2px 6px;">' + message + '</div>';
        return;
      }
      filtered.forEach(item => {
        const data = item.data;
        const card = document.createElement('div');
        card.className = 'vocab-item';
        const wordEl = document.createElement('div');
        wordEl.className = 'vocab-word';
        wordEl.textContent = data.word || 'Unknown';
        const defEl = document.createElement('div');
        defEl.className = 'vocab-definition';
        defEl.innerHTML = data.definition ? escapeHtml(data.definition) : '';
        // Create a delete button for this vocab entry
        const delBtn = document.createElement('button');
        delBtn.className = 'vocab-delete-btn';
        delBtn.textContent = 'Delete';
        delBtn.title = 'Delete word';
        delBtn.addEventListener('click', async (e) => {
          e.stopPropagation();
          if (confirm('Delete this vocabulary entry?')) {
            await deleteVocab(item.id);
          }
        });
        // Append elements to the card
        card.appendChild(wordEl);
        card.appendChild(defEl);
        card.appendChild(delBtn);
        container.appendChild(card);
      });
    }

    // Add a new vocabulary item. Supports single entry or multi-line enumerated list.
    async function addVocab() {
      const wordInput = document.getElementById('word');
      const defInput = document.getElementById('definition');
      if (!wordInput || !defInput) return;
      const word = (wordInput.value || '').trim();
      const definition = (defInput.value || '').trim();
      // Single entry
      if (word && definition) {
        await addDoc(vocabRef, {
          word: word,
          definition: definition,
          timestamp: Date.now(),
          date: new Date().toLocaleString()
        });
        wordInput.value = '';
        defInput.value = '';
        renderVocab();
        alert('Word added successfully.');
        return;
      }
      // Multi-line input
      if (!definition) {
        alert('Please enter some vocabulary entries or provide both a word and definition.');
        return;
      }
      const lines = definition.split(/\n+/);
      let addedCount = 0;
      for (const line of lines) {
        const trimmed = line.trim();
        if (!trimmed) continue;
        const noEnum = trimmed.replace(/^\s*\d+\.\s*/, '').replace(/^[-‚Ä¢]\s*/, '');
        const parts = noEnum.split(/:\s*/);
        if (parts.length < 2) continue;
        let w = parts[0].trim();
        let def = parts.slice(1).join(':').trim();
        // Remove parts of speech in parentheses
        w = w.replace(/\([^)]*\)/g, '').trim();
        if (!w || !def) continue;
        try {
          await addDoc(vocabRef, {
            word: w,
            definition: def,
            timestamp: Date.now(),
            date: new Date().toLocaleString()
          });
          addedCount++;
        } catch (err) {
          console.error('Failed to add vocab:', err);
        }
      }
      wordInput.value = '';
      defInput.value = '';
      renderVocab();
      if (addedCount > 0) {
        alert(addedCount + ' vocab item(s) added successfully.');
      } else {
        alert('No valid vocab entries found.');
      }
    }

    // Search vocabulary by word
    function searchVocab() {
      const searchInput = document.getElementById('vocabSearch');
      if (!searchInput) return;
      const q = (searchInput.value || '').trim();
      renderVocab(q);
    }

    /**
     * Delete a vocabulary item by its document ID.  This helper calls
     * Firestore's deleteDoc() and then re-renders the vocabulary list.
     * A confirmation prompt should be shown by the caller before invoking
     * this function.
     * @param {string} id - The document ID of the vocabulary item to delete.
     */
    async function deleteVocab(id) {
      if (!id) return;
      try {
        const ref = doc(vocabRef, id);
        await deleteDoc(ref);
        // Refresh the vocab list with the current search query, if any
        const searchInput = document.getElementById('vocabSearch');
        const q = searchInput ? (searchInput.value || '').trim() : '';
        renderVocab(q);
      } catch (err) {
        console.error('Failed to delete vocab:', err);
        alert('Failed to delete this vocabulary entry.');
      }
    }

    // Bind vocabulary events
    document.getElementById('addVocabBtn')?.addEventListener('click', addVocab);
    document.getElementById('vocabSearchBtn')?.addEventListener('click', searchVocab);
    const vocabSearchEl = document.getElementById('vocabSearch');
    if (vocabSearchEl) {
      vocabSearchEl.addEventListener('keydown', (e) => {
        if (e.key === 'Enter') {
          e.preventDefault();
          searchVocab();
        }
      });
    }
    const backBtn = document.getElementById('backToEssays');
    if (backBtn) {
      backBtn.addEventListener('click', (e) => {
        e.preventDefault();
        switchToEssays();
      });
    }

    // Hide legacy sticker images for buttons and cards in case CSS fails to override.
    // We prefer using emoji-based stickers instead of the old base64 images.
    document.querySelectorAll('.btn-sticker, .card-sticker').forEach(el => {
      el.style.display = 'none';
    });
    // Expose modal functions for inline handlers
    window.openEditModal = openEditModal;
    window.closeEditModal = closeEditModal;
    window.saveEdit = saveEdit;
    window.openFeedbackModal = openFeedbackModal;
    window.closeFeedbackModal = closeFeedbackModal;
    window.saveFeedback = saveFeedback;
    // Expose formatting functions
    window.highlightSelection = highlightSelection;
    window.underlineSelection = underlineSelection;
    window.strikeSelection = strikeSelection;

    // Make section switching functions globally accessible so inline HTML
    // onclick handlers can invoke them.  Without these assignments the
    // functions live in the module scope and are unavailable to the anchor
    // element defined in the HTML.
    window.switchToVocab = switchToVocab;
    window.switchToEssays = switchToEssays;
    // Expose deleteVocab for potential inline usage (not required for current
    // implementation, but kept for consistency with other exposed functions)
    window.deleteVocab = deleteVocab;
  </script>
</body>
</html>